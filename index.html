<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰‘ä¸‰æ´»åŠ¨åŒ¹é…ç³»ç»Ÿ</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            background-color: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background-color: #2196f3;
            color: white;
        }

        .content {
            background-color: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            min-height: 500px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        h3 {
            color: #555;
            margin: 20px 0 10px 0;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #2196f3;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .profession-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }

        .tag {
            padding: 8px 12px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
        }

        .tag:hover {
            border-color: #2196f3;
        }

        .tag.selected {
            background-color: #2196f3;
            color: white;
            border-color: #2196f3;
        }

        .tag.healer {
            background-color: #e8f5e9;
            border-color: #81c784;
            color: #388e3c;
        }

        .tag.healer.selected {
            background-color: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .button:hover {
            background-color: #1976d2;
        }

        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .button.success {
            background-color: #4caf50;
        }

        .button.danger {
            background-color: #f44336;
        }

        .button.small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .user-item, .team-item, .signup-item {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info, .team-info {
            flex: 1;
        }

        .user-name, .team-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .user-professions, .team-tips {
            font-size: 14px;
            color: #666;
        }

        .status-bar {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            color: #1976d2;
        }

        .status-bar.online {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .message.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .team-members {
            margin-top: 8px;
            font-size: 14px;
        }

        .member-slot {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background-color: #e3f2fd;
            border-radius: 4px;
            font-size: 12px;
        }

        .member-slot.empty {
            background-color: #f5f5f5;
            color: #999;
        }

        .pool-info {
            background-color: #e8f5e9;
            border: 1px solid #a5d6a7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .match-result {
            margin-top: 20px;
        }

        .team {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .team-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .rules-section {
            margin-bottom: 30px;
        }

        .rules-section h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .rule-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .rule-item h4 {
            color: #2196f3;
            margin-bottom: 8px;
        }

        .edit-tips-section {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .admin-section {
            background-color: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .admin-section h3 {
            color: #f57c00;
        }

        .team-container {
            background-color: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .join-section {
            margin-top: 10px;
            padding: 10px;
            background-color: #f0f7ff;
            border: 1px solid #bbdefb;
            border-radius: 8px;
        }

        .action-section {
            margin-top: 10px;
            padding: 10px;
            display: flex;
            gap: 10px;
        }

        .login-reminder {
            background-color: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #f57c00;
        }

        .current-user-display {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-user-display .user-label {
            color: #1976d2;
            font-weight: 500;
        }

        .current-user-display .user-id {
            color: #333;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .rules-quick {
            background-color: #f0f7ff;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .rules-quick h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .rules-quick ul {
            list-style: none;
            padding-left: 0;
        }

        .rules-quick li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .rules-quick li:before {
            content: "â€¢";
            color: #2196f3;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        @media (max-width: 600px) {
            .nav-tab {
                font-size: 14px;
                padding: 12px 8px;
            }
            
            .profession-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('user')">ç”¨æˆ·ä¸­å¿ƒ</button>
            <button class="nav-tab" onclick="switchTab('match')">å¯¹æ’æ´»åŠ¨</button>
            <button class="nav-tab" onclick="switchTab('jjc')">JJCç»„é˜Ÿ</button>
            <button class="nav-tab" onclick="switchTab('rules')">æ´»åŠ¨è§„åˆ™</button>
        </div>
        
        <div class="content">
            <div id="connection-status" class="status-bar">
                æ­£åœ¨è¿æ¥æœåŠ¡å™¨...
            </div>
            
            <!-- å½“å‰ç”¨æˆ·æ˜¾ç¤º -->
            <div id="current-user-display" class="current-user-display" style="display:none;">
                <span class="user-label">å½“å‰ç”¨æˆ·ï¼š</span>
                <span class="user-id" id="current-user-id">æœªç™»å½•</span>
            </div>
            
            <!-- ç”¨æˆ·ä¸­å¿ƒé¡µé¢ -->
            <div id="user-page" class="page active">
                <h2>ç”¨æˆ·ä¸­å¿ƒ</h2>
                <div id="user-message"></div>
                
                <!-- æ³¨å†Œ/ç™»å½• -->
                <div class="form-group">
                    <label for="userId">ç”¨æˆ·ID</label>
                    <input type="text" id="userId" placeholder="è¯·è¾“å…¥ä½ çš„æ¸¸æˆID">
                    <button class="button success" onclick="registerOrLogin()">æ³¨å†Œ/ç™»å½•</button>
                </div>
                
                <!-- ç¼–è¾‘è¶…çˆ±å¿ƒæ³• -->
                <div id="love-professions-section" style="display:none;">
                    <h3>ç¼–è¾‘ä½ çš„è¶…çˆ±å¿ƒæ³•ï¼ˆå¯å¤šé€‰ï¼‰</h3>
                    <div class="form-group">
                        <label>DPSèŒä¸š</label>
                        <div class="profession-grid" id="love-dps-container"></div>
                    </div>
                    <div class="form-group">
                        <label>å¥¶å¦ˆèŒä¸š</label>
                        <div class="profession-grid" id="love-healer-container"></div>
                    </div>
                    <button class="button" onclick="saveLoveProfessions()">ä¿å­˜è¶…çˆ±å¿ƒæ³•</button>
                </div>
                
                <!-- ç”¨æˆ·åˆ—è¡¨ -->
                <h3>æ‰€æœ‰ç”¨æˆ·</h3>
                <div id="all-users-list"></div>
            </div>
            
            <!-- å¯¹æ’æ´»åŠ¨é¡µé¢ -->
            <div id="match-page" class="page">
                <h2>å¯¹æ’æ´»åŠ¨</h2>
                <div id="match-message"></div>
                
                <!-- ç®¡ç†å‘˜è®¾ç½®èŒä¸šæ±  -->
                <div class="admin-section">
                    <h3>ç®¡ç†å‘˜ï¼šè®¾ç½®æœ¬æ¬¡æ´»åŠ¨èŒä¸šæ± </h3>
                    <div class="form-group">
                        <label>é€‰æ‹©æœ¬æ¬¡æ´»åŠ¨å¯ç”¨çš„DPSèŒä¸š</label>
                        <div class="profession-grid" id="pool-dps-container"></div>
                    </div>
                    <div class="form-group">
                        <label>é€‰æ‹©æœ¬æ¬¡æ´»åŠ¨å¯ç”¨çš„å¥¶å¦ˆèŒä¸š</label>
                        <div class="profession-grid" id="pool-healer-container"></div>
                    </div>
                    <button class="button" onclick="saveMatchPool()">ä¿å­˜èŒä¸šæ± è®¾ç½®</button>
                </div>
                
                <!-- å½“å‰èŒä¸šæ±  -->
                <div id="current-pool-info" class="pool-info" style="display:none;">
                    <h4>å½“å‰æ´»åŠ¨èŒä¸šæ± </h4>
                    <div id="current-pool-content"></div>
                </div>
                
                <!-- å¯æŠ¥åç”¨æˆ· -->
                <h3>å¯æŠ¥åç”¨æˆ·</h3>
                <div id="available-match-users"></div>
                
                <div class="status-bar">
                    å½“å‰æŠ¥åäººæ•°ï¼š<span id="signup-count">0</span> äººï¼ˆéœ€è¦è‡³å°‘6äººæ‰èƒ½å¼€å§‹æŠ½ç­¾ï¼‰
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="button success" onclick="signupMatch()" id="signup-btn">æŠ¥åå‚åŠ </button>
                    <button class="button danger" onclick="cancelSignup()" id="cancel-signup-btn" style="display:none;">å–æ¶ˆæŠ¥å</button>
                </div>
                
                <!-- å·²æŠ¥åç”¨æˆ·åˆ—è¡¨ -->
                <h3>å·²æŠ¥åç”¨æˆ·</h3>
                <div id="signed-up-users"></div>
                
                <!-- æŠ½ç­¾æŒ‰é’® -->
                <button class="button success" onclick="startMatching()" id="match-button" disabled style="width: 100%;">
                    å¼€å§‹æŠ½ç­¾åˆ†é˜Ÿ
                </button>
                
                <div id="match-results" class="match-result"></div>
            </div>
            
            <!-- JJCç»„é˜Ÿé¡µé¢ -->
            <div id="jjc-page" class="page">
                <h2>JJCç»„é˜Ÿé¢„çº¦</h2>
                <div id="jjc-message"></div>
                
                <!-- æœªç™»å½•æç¤º -->
                <div id="jjc-login-reminder" class="login-reminder" style="display:none;">
                    è¯·å…ˆåœ¨ç”¨æˆ·ä¸­å¿ƒç™»å½•åå†è¿›è¡Œç»„é˜Ÿæ“ä½œ
                </div>
                
                <!-- åˆ›å»ºé˜Ÿä¼æŒ‰é’® -->
                <div id="jjc-create-section" style="text-align: center; margin-bottom: 20px;">
                    <button class="button success" onclick="openCreateTeamModal()">åˆ›å»ºæ–°é˜Ÿä¼</button>
                </div>
                
                <!-- é˜Ÿä¼åˆ—è¡¨ -->
                <h3>é˜Ÿä¼åˆ—è¡¨</h3>
                <div id="teams-list"></div>
            </div>
            
            <!-- æ´»åŠ¨è§„åˆ™é¡µé¢ -->
            <div id="rules-page" class="page">
                <h2>æ´»åŠ¨è§„åˆ™è¯´æ˜</h2>
                
                <div class="rules-quick">
                    <h4>å¿«é€Ÿäº†è§£</h4>
                    <ul>
                        <li>æ³¨å†Œåªéœ€è¾“å…¥æ¸¸æˆIDï¼Œæ— éœ€å¯†ç </li>
                        <li>è®¾ç½®è¶…çˆ±å¿ƒæ³•ï¼Œè®©ç³»ç»Ÿä¼˜å…ˆåˆ†é…ä½ å–œæ¬¢çš„èŒä¸š</li>
                        <li>å¯¹æ’æ´»åŠ¨æ»¡6äººè‡ªåŠ¨å¼€å§‹ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…é˜Ÿä¼</li>
                        <li>JJCç»„é˜Ÿå¯è‡ªç”±åˆ›å»ºé˜Ÿä¼ï¼Œæœ€å¤š3äºº</li>
                    </ul>
                </div>
                
                <div class="rules-section">
                    <h3>ğŸ“ ç”¨æˆ·ç³»ç»Ÿ</h3>
                    <div class="rule-item">
                        <p><strong>ä¸€é”®æ³¨å†Œï¼š</strong>è¾“å…¥æ¸¸æˆIDå³å¯ä½¿ç”¨ï¼Œæ— éœ€å¤æ‚æµç¨‹</p>
                        <p><strong>è¶…çˆ±å¿ƒæ³•ï¼š</strong>é€‰æ‹©ä½ æœ€æ“…é•¿çš„èŒä¸šï¼Œç³»ç»Ÿä¼šä¼˜å…ˆä¸ºä½ åˆ†é…</p>
                    </div>
                </div>
                
                <div class="rules-section">
                    <h3>âš”ï¸ å¯¹æ’æ´»åŠ¨</h3>
                    <div class="rule-item">
                        <h4>æ´»åŠ¨æµç¨‹</h4>
                        <p>1. ç®¡ç†å‘˜è®¾ç½®æœ¬æ¬¡æ´»åŠ¨çš„èŒä¸šæ± </p>
                        <p>2. ç©å®¶ç‚¹å‡»æŠ¥åå‚åŠ </p>
                        <p>3. æ»¡6äººåå¼€å§‹æŠ½ç­¾</p>
                        <p>4. ç³»ç»Ÿè‡ªåŠ¨åˆ†é…æˆ2é˜Ÿï¼ˆæ¯é˜Ÿ2DPS+1å¥¶å¦ˆï¼‰</p>
                    </div>
                    <div class="rule-item">
                        <h4>æ™ºèƒ½åˆ†é…</h4>
                        <p>â€¢ ä¼˜å…ˆåˆ†é…ä½ çš„è¶…çˆ±å¿ƒæ³•èŒä¸š</p>
                        <p>â€¢ å¦‚æœè¶…çˆ±å¿ƒæ³•ä¸åœ¨èŒä¸šæ± ä¸­ï¼Œéšæœºåˆ†é…æ± å†…èŒä¸š</p>
                        <p>â€¢ ç¡®ä¿æ¯é˜Ÿé…ç½®åˆç†</p>
                    </div>
                </div>
                
                <div class="rules-section">
                    <h3>ğŸ† JJCç»„é˜Ÿ</h3>
                    <div class="rule-item">
                        <h4>çµæ´»ç»„é˜Ÿ</h4>
                        <p>â€¢ åˆ›å»ºé˜Ÿä¼æ—¶å¡«å†™è¯´æ˜ï¼ˆæ—¶é—´ã€æ®µä½ç­‰ï¼‰</p>
                        <p>â€¢ é€‰æ‹©å¿ƒæ³•åŠ å…¥é˜Ÿä¼</p>
                        <p>â€¢ æ»¡3äººè‡ªåŠ¨æ»¡å‘˜</p>
                        <p>â€¢ åˆ›å»ºè€…å¯ä¿®æ”¹è¯´æ˜å’Œåˆ é™¤é˜Ÿä¼</p>
                    </div>
                </div>
                
                <div class="rules-section">
                    <h3>ğŸ¯ èŒä¸šåˆ—è¡¨</h3>
                    <div class="rule-item">
                        <p><strong>DPSï¼š</strong>å’Œå°šã€å†°å¿ƒã€èŠ±é—´æ¸¸ã€æ°”çº¯ã€å‰‘çº¯ã€å¤©ç­–ã€è—å‰‘ã€æ¯’ç»ã€é²¸é±¼ã€ç”°èºã€æ˜æ•™ã€ä¸å¸®ã€è‹äº‘ã€è«é—®ã€éœ¸åˆ€ã€è“¬è±ã€å‡Œé›ªã€è¡å¤©ã€æ— æ–¹ã€åˆ€å®—ã€ä¸‡çµã€æ®µæ°</p>
                        <p><strong>æ²»ç–—ï¼š</strong>å¥¶ç§€ã€å¥¶æ¯’ã€å¥¶èŠ±ã€å¥¶æ­Œã€å¥¶è¯</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºé˜Ÿä¼æ¨¡æ€æ¡† -->
    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateTeamModal()">&times;</span>
            <div class="modal-header">åˆ›å»ºæ–°é˜Ÿä¼</div>
            <div class="form-group">
                <label for="team-tips">é˜Ÿä¼è¯´æ˜ï¼ˆè¯·æ³¨æ˜å¼€æ‰“æ—¶é—´å’Œæ®µä½ï¼‰</label>
                <textarea id="team-tips" placeholder="ä¾‹å¦‚ï¼šä»Šæ™š8ç‚¹ï¼Œ1800-2000æ®µä½ï¼Œéœ€è¦ç¨³å®šçš„DPS"></textarea>
            </div>
            <div class="modal-footer">
                <button class="button" onclick="closeCreateTeamModal()">å–æ¶ˆ</button>
                <button class="button success" onclick="createTeam()">åˆ›å»ºé˜Ÿä¼</button>
            </div>
        </div>
    </div>

    <script>
        // Firebaseé…ç½® - è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„é…ç½®
        const firebaseConfig = {
            // åœ¨è¿™é‡Œå¡«å…¥ä½ çš„Firebaseé…ç½®
          apiKey: "AIzaSyAqAl228PwAygdjgmbI-B7zvpaGmgkNREE",
          authDomain: "user-ba917.firebaseapp.com",
          databaseURL: "https://user-ba917-default-rtdb.firebaseio.com",
          projectId: "user-ba917",
          storageBucket: "user-ba917.firebasestorage.app",
          messagingSenderId: "648289853069",
          appId: "1:648289853069:web:fbfdbd13b6023fca928cc4",
        };

        // èŒä¸šæ•°æ®
        const dpsProfessions = [
            'å’Œå°š', 'å†°å¿ƒ', 'èŠ±é—´æ¸¸', 'æ°”çº¯', 'å‰‘çº¯', 'å¤©ç­–', 'è—å‰‘', 'æ¯’ç»', 
            'é²¸é±¼', 'ç”°èº', 'æ˜æ•™', 'ä¸å¸®', 'è‹äº‘', 'è«é—®', 'éœ¸åˆ€', 'è“¬è±', 
            'å‡Œé›ª', 'è¡å¤©', 'æ— æ–¹', 'åˆ€å®—', 'ä¸‡çµ', 'æ®µæ°'
        ];
        
        const healerProfessions = ['å¥¶ç§€', 'å¥¶æ¯’', 'å¥¶èŠ±', 'å¥¶æ­Œ', 'å¥¶è¯'];
        
        // å…¨å±€å˜é‡
        let database;
        let currentUser = null;
        let users = {};
        let matchPool = { dps: [], healers: [] };
        let matchSignups = {};
        let jjcTeams = {};
        let teamCounter = 0; // é˜Ÿä¼è®¡æ•°å™¨
        
        // åˆå§‹åŒ–Firebase
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                // ç›‘å¬è¿æ¥çŠ¶æ€
                database.ref('.info/connected').on('value', (snapshot) => {
                    const connected = snapshot.val();
                    const statusEl = document.getElementById('connection-status');
                    if (connected) {
                        statusEl.className = 'status-bar online';
                        statusEl.innerHTML = 'âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨';
                    } else {
                        statusEl.className = 'status-bar';
                        statusEl.innerHTML = 'âŒ è¿æ¥å·²æ–­å¼€';
                    }
                });
                
                // ç›‘å¬æ•°æ®å˜åŒ–
                database.ref('users').on('value', (snapshot) => {
                    users = snapshot.val() || {};
                    updateAllUsersList();
                    updateAvailableMatchUsers();
                });
                
                database.ref('matchPool').on('value', (snapshot) => {
                    matchPool = snapshot.val() || { dps: [], healers: [] };
                    updateMatchPoolDisplay();
                });
                
                database.ref('matchSignups').on('value', (snapshot) => {
                    matchSignups = snapshot.val() || {};
                    updateSignedUpUsers();
                    updateMatchPageUserStatus();
                    updateAvailableMatchUsers();
                });
                
                database.ref('jjcTeams').on('value', (snapshot) => {
                    jjcTeams = snapshot.val() || {};
                    updateTeamsList();
                });
                
                // è·å–é˜Ÿä¼è®¡æ•°å™¨
                database.ref('teamCounter').on('value', (snapshot) => {
                    teamCounter = snapshot.val() || 0;
                });
                
                return true;
            } catch (error) {
                console.error('Firebaseåˆå§‹åŒ–å¤±è´¥:', error);
                return false;
            }
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tab}-page`).classList.add('active');
            
            // åˆ‡æ¢åˆ°JJCé¡µé¢æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (tab === 'jjc') {
                updateJJCLoginStatus();
            }
            
            clearMessages();
        }
        
        // æ›´æ–°å½“å‰ç”¨æˆ·æ˜¾ç¤º
        function updateCurrentUserDisplay() {
            const display = document.getElementById('current-user-display');
            const userIdSpan = document.getElementById('current-user-id');
            
            if (currentUser) {
                display.style.display = 'flex';
                userIdSpan.textContent = currentUser;
            } else {
                display.style.display = 'none';
                userIdSpan.textContent = 'æœªç™»å½•';
            }
        }
        
        // æ›´æ–°JJCé¡µé¢ç™»å½•çŠ¶æ€
        function updateJJCLoginStatus() {
            const loginReminder = document.getElementById('jjc-login-reminder');
            const createSection = document.getElementById('jjc-create-section');
            
            if (!currentUser) {
                loginReminder.style.display = 'block';
                createSection.style.display = 'none';
            } else {
                loginReminder.style.display = 'none';
                createSection.style.display = 'block';
            }
            
            // æ›´æ–°é˜Ÿä¼åˆ—è¡¨
            updateTeamsList();
        }
        
        // æ³¨å†Œæˆ–ç™»å½•
        function registerOrLogin() {
            const userId = document.getElementById('userId').value.trim();
            
            if (!userId) {
                showMessage('user-message', 'è¯·è¾“å…¥ç”¨æˆ·ID', 'error');
                return;
            }
            
            currentUser = userId;
            
            if (!users[userId]) {
                // æ–°ç”¨æˆ·æ³¨å†Œ
                database.ref(`users/${userId}`).set({
                    loveProfessions: [],
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });
                showMessage('user-message', `æ¬¢è¿ ${userId}ï¼è¯·è®¾ç½®ä½ çš„è¶…çˆ±å¿ƒæ³•`, 'success');
            } else {
                showMessage('user-message', `æ¬¢è¿å›æ¥ ${userId}ï¼`, 'success');
            }
            
            // æ˜¾ç¤ºè¶…çˆ±å¿ƒæ³•ç¼–è¾‘åŒº
            document.getElementById('love-professions-section').style.display = 'block';
            initLoveProfessions();
            
            // æ›´æ–°å¯¹æ’å’ŒJJCé¡µé¢çš„ç”¨æˆ·çŠ¶æ€
            updateMatchPageUserStatus();
            updateJJCLoginStatus();
            updateCurrentUserDisplay();
        }
        
        // åˆå§‹åŒ–è¶…çˆ±å¿ƒæ³•é€‰æ‹©
        function initLoveProfessions() {
            const dpsContainer = document.getElementById('love-dps-container');
            const healerContainer = document.getElementById('love-healer-container');
            
            dpsContainer.innerHTML = '';
            healerContainer.innerHTML = '';
            
            const userLoveProfessions = users[currentUser]?.loveProfessions || [];
            
            dpsProfessions.forEach(prof => {
                const tag = createProfessionTag(prof, 'dps', userLoveProfessions.includes(prof));
                dpsContainer.appendChild(tag);
            });
            
            healerProfessions.forEach(prof => {
                const tag = createProfessionTag(prof, 'healer', userLoveProfessions.includes(prof));
                healerContainer.appendChild(tag);
            });
        }
        
        // åˆå§‹åŒ–èŒä¸šæ± é€‰æ‹©ï¼ˆç®¡ç†å‘˜ï¼‰
        function initPoolProfessions() {
            const dpsContainer = document.getElementById('pool-dps-container');
            const healerContainer = document.getElementById('pool-healer-container');
            
            dpsContainer.innerHTML = '';
            healerContainer.innerHTML = '';
            
            dpsProfessions.forEach(prof => {
                const tag = createProfessionTag(prof, 'dps', matchPool.dps?.includes(prof));
                dpsContainer.appendChild(tag);
            });
            
            healerProfessions.forEach(prof => {
                const tag = createProfessionTag(prof, 'healer', matchPool.healers?.includes(prof));
                healerContainer.appendChild(tag);
            });
        }
        
        // åˆ›å»ºèŒä¸šæ ‡ç­¾
        function createProfessionTag(profession, type, selected = false) {
            const tag = document.createElement('div');
            tag.className = `tag ${type} ${selected ? 'selected' : ''}`;
            tag.textContent = profession;
            tag.onclick = () => tag.classList.toggle('selected');
            return tag;
        }
        
        // ä¿å­˜è¶…çˆ±å¿ƒæ³•
        function saveLoveProfessions() {
            if (!currentUser) {
                showMessage('user-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            const selected = [...document.querySelectorAll('#love-professions-section .tag.selected')]
                .map(tag => tag.textContent);
            
            database.ref(`users/${currentUser}/loveProfessions`).set(selected);
            showMessage('user-message', 'è¶…çˆ±å¿ƒæ³•ä¿å­˜æˆåŠŸï¼', 'success');
        }
        
        // ä¿å­˜èŒä¸šæ± è®¾ç½®ï¼ˆç®¡ç†å‘˜ï¼‰
        function saveMatchPool() {
            const selectedDps = [...document.querySelectorAll('#pool-dps-container .tag.selected')]
                .map(tag => tag.textContent);
            const selectedHealers = [...document.querySelectorAll('#pool-healer-container .tag.selected')]
                .map(tag => tag.textContent);
            
            if (selectedDps.length === 0 || selectedHealers.length === 0) {
                showMessage('match-message', 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªDPSå’Œä¸€ä¸ªå¥¶å¦ˆèŒä¸š', 'error');
                return;
            }
            
            database.ref('matchPool').set({
                dps: selectedDps,
                healers: selectedHealers
            });
            
            showMessage('match-message', 'èŒä¸šæ± è®¾ç½®æˆåŠŸï¼', 'success');
        }
        
        // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
        function updateAllUsersList() {
            const container = document.getElementById('all-users-list');
            container.innerHTML = '';
            
            Object.entries(users).forEach(([userId, user]) => {
                const item = document.createElement('div');
                item.className = 'user-item';
                item.innerHTML = `
                    <div class="user-info">
                        <div class="user-name">${userId}</div>
                        <div class="user-professions">è¶…çˆ±å¿ƒæ³•ï¼š${user.loveProfessions?.join('ã€') || 'æœªè®¾ç½®'}</div>
                    </div>
                    <div>
                        <button class="button small danger" onclick="deleteUser('${userId}')">åˆ é™¤ç”¨æˆ·</button>
                    </div>
                `;
                container.appendChild(item);
            });
            
            if (Object.keys(users).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— æ³¨å†Œç”¨æˆ·</p>';
            }
        }
        
        // åˆ é™¤ç”¨æˆ·
        function deleteUser(userId) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${userId} å—ï¼Ÿ`)) {
                database.ref(`users/${userId}`).remove();
                // åŒæ—¶åˆ é™¤è¯¥ç”¨æˆ·çš„æŠ¥åä¿¡æ¯
                database.ref(`matchSignups/${userId}`).remove();
                // åˆ é™¤è¯¥ç”¨æˆ·åœ¨JJCé˜Ÿä¼ä¸­çš„ä¿¡æ¯
                Object.keys(jjcTeams).forEach(teamId => {
                    database.ref(`jjcTeams/${teamId}/members/${userId}`).remove();
                });
                showMessage('user-message', `ç”¨æˆ· ${userId} å·²åˆ é™¤`, 'success');
            }
        }
        
        // æ›´æ–°èŒä¸šæ± æ˜¾ç¤º
        function updateMatchPoolDisplay() {
            initPoolProfessions();
            
            if (matchPool.dps?.length > 0 || matchPool.healers?.length > 0) {
                document.getElementById('current-pool-info').style.display = 'block';
                document.getElementById('current-pool-content').innerHTML = `
                    <div><strong>DPSèŒä¸šï¼š</strong>${matchPool.dps?.join('ã€') || 'æœªè®¾ç½®'}</div>
                    <div><strong>å¥¶å¦ˆèŒä¸šï¼š</strong>${matchPool.healers?.join('ã€') || 'æœªè®¾ç½®'}</div>
                `;
            } else {
                document.getElementById('current-pool-info').style.display = 'none';
            }
        }
        
        // æ›´æ–°å¯æŠ¥åç”¨æˆ·åˆ—è¡¨
        function updateAvailableMatchUsers() {
            const container = document.getElementById('available-match-users');
            container.innerHTML = '';
            
            Object.entries(users).forEach(([userId, user]) => {
                const isSignedUp = matchSignups[userId];
                const item = document.createElement('div');
                item.className = 'user-item';
                item.innerHTML = `
                    <div class="user-info">
                        <div class="user-name">${userId}</div>
                        <div class="user-professions">è¶…çˆ±å¿ƒæ³•ï¼š${user.loveProfessions?.join('ã€') || 'æœªè®¾ç½®'}</div>
                    </div>
                    <div>
                        ${currentUser === userId ? 
                            (isSignedUp ? 
                                '<span style="color: #4caf50;">å·²æŠ¥å</span>' : 
                                '<button class="button small success" onclick="quickSignup()">å¿«é€ŸæŠ¥å</button>'
                            ) : 
                            (isSignedUp ? '<span style="color: #999;">å·²æŠ¥å</span>' : '')
                        }
                    </div>
                `;
                container.appendChild(item);
            });
            
            if (Object.keys(users).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— å¯æŠ¥åç”¨æˆ·</p>';
            }
        }
        
        // å¿«é€ŸæŠ¥å
        function quickSignup() {
            if (!currentUser) {
                showMessage('match-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            signupMatch();
        }
        
        // æŠ¥åå¯¹æ’
        function signupMatch() {
            if (!currentUser) {
                showMessage('match-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            if (!matchPool.dps?.length || !matchPool.healers?.length) {
                showMessage('match-message', 'ç®¡ç†å‘˜è¿˜æœªè®¾ç½®èŒä¸šæ± ï¼Œè¯·ç¨åå†è¯•', 'error');
                return;
            }
            
            database.ref(`matchSignups/${currentUser}`).set({
                userId: currentUser,
                signedUpAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            showMessage('match-message', `æŠ¥åæˆåŠŸï¼`, 'success');
        }
        
        // å–æ¶ˆæŠ¥å
        function cancelSignup() {
            if (!currentUser) return;
            
            database.ref(`matchSignups/${currentUser}`).remove();
            showMessage('match-message', 'å·²å–æ¶ˆæŠ¥å', 'success');
        }
        
        // æ›´æ–°ç”¨æˆ·åœ¨å¯¹æ’é¡µé¢çš„çŠ¶æ€
        function updateMatchPageUserStatus() {
            if (currentUser && matchSignups[currentUser]) {
                document.getElementById('signup-btn').style.display = 'none';
                document.getElementById('cancel-signup-btn').style.display = 'inline-block';
            } else {
                document.getElementById('signup-btn').style.display = 'inline-block';
                document.getElementById('cancel-signup-btn').style.display = 'none';
            }
        }
        
        // æ›´æ–°å·²æŠ¥åç”¨æˆ·åˆ—è¡¨
        function updateSignedUpUsers() {
            const container = document.getElementById('signed-up-users');
            container.innerHTML = '';
            
            const signupsList = Object.values(matchSignups);
            const signupCount = signupsList.length;
            
            document.getElementById('signup-count').textContent = signupCount;
            document.getElementById('match-button').disabled = signupCount < 6;
            
            signupsList.forEach(signup => {
                const user = users[signup.userId];
                if (user) {
                    const item = document.createElement('div');
                    item.className = 'signup-item';
                    item.innerHTML = `
                        <div class="user-info">
                            <div class="user-name">${signup.userId}</div>
                            <div class="user-professions">è¶…çˆ±å¿ƒæ³•ï¼š${user.loveProfessions?.join('ã€') || 'æœªè®¾ç½®'}</div>
                        </div>
                    `;
                    container.appendChild(item);
                }
            });
            
            if (signupsList.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— æŠ¥åç”¨æˆ·</p>';
            }
        }
        
        // å¼€å§‹åŒ¹é…
        function startMatching() {
            const signupsList = Object.values(matchSignups).map(signup => ({
                id: signup.userId,
                ...users[signup.userId]
            }));
            
            if (signupsList.length < 6) {
                showMessage('match-message', 'æŠ¥åäººæ•°ä¸è¶³6äºº', 'error');
                return;
            }
            
            // éšæœºæ‰“ä¹±ç”¨æˆ·
            const shuffled = shuffle([...signupsList]);
            const teams = [];
            
            // åˆ†é…é˜Ÿä¼
            while (shuffled.length >= 3) {
                const team = [];
                for (let i = 0; i < 3; i++) {
                    const player = shuffled.shift();
                    const role = i < 2 ? 'dps' : 'healer';
                    const profession = assignProfessionFromPool(player, role);
                    
                    team.push({
                        name: player.id,
                        role: role,
                        profession: profession
                    });
                }
                teams.push(team);
            }
            
            displayMatchResults(teams, shuffled);
        }
        
        // ä»èŒä¸šæ± ä¸­åˆ†é…èŒä¸š
        function assignProfessionFromPool(player, role) {
            const pool = role === 'dps' ? matchPool.dps : matchPool.healers;
            
            // ä¼˜å…ˆä»ç©å®¶çš„è¶…çˆ±å¿ƒæ³•ä¸­é€‰æ‹©ï¼ˆå¿…é¡»åœ¨æ± ä¸­ï¼‰
            const playerLoveProfessions = (player.loveProfessions || []).filter(prof => 
                pool.includes(prof)
            );
            
            if (playerLoveProfessions.length > 0) {
                return playerLoveProfessions[Math.floor(Math.random() * playerLoveProfessions.length)];
            }
            
            // å¦åˆ™ä»æ± ä¸­éšæœºé€‰æ‹©
            return pool[Math.floor(Math.random() * pool.length)];
        }
        
        // æ˜¾ç¤ºåŒ¹é…ç»“æœ
        function displayMatchResults(teams, remaining) {
            const container = document.getElementById('match-results');
            container.innerHTML = '<h3>åŒ¹é…ç»“æœ</h3>';
            
            teams.forEach((team, index) => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team';
                teamDiv.innerHTML = `
                    <div class="team-header">ç¬¬ ${index + 1} é˜Ÿ</div>
                    ${team.map(member => `
                        <div>${member.name} - ${member.profession}</div>
                    `).join('')}
                `;
                container.appendChild(teamDiv);
            });
            
            if (remaining.length > 0) {
                container.innerHTML += `<p>è½®ç©ºç©å®¶ï¼š${remaining.map(u => u.id).join('ã€')}</p>`;
            }
            
            // æ¸…ç©ºæŠ¥ååˆ—è¡¨
            database.ref('matchSignups').remove();
        }
        
        // æ‰“å¼€åˆ›å»ºé˜Ÿä¼æ¨¡æ€æ¡†
        function openCreateTeamModal() {
            if (!currentUser) {
                showMessage('jjc-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            document.getElementById('createTeamModal').style.display = 'block';
            document.getElementById('team-tips').value = '';
        }
        
        // å…³é—­åˆ›å»ºé˜Ÿä¼æ¨¡æ€æ¡†
        function closeCreateTeamModal() {
            document.getElementById('createTeamModal').style.display = 'none';
        }
        
        // åˆ›å»ºJJCé˜Ÿä¼ï¼ˆå¸¦é˜Ÿä¼è¯´æ˜ï¼‰
        function createTeam() {
            if (!currentUser) {
                showMessage('jjc-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            const teamTips = document.getElementById('team-tips').value.trim();
            
            // å¢åŠ è®¡æ•°å™¨
            const newTeamNumber = teamCounter + 1;
            database.ref('teamCounter').set(newTeamNumber);
            
            const teamId = `team_${Date.now()}`;
            database.ref(`jjcTeams/${teamId}`).set({
                id: teamId,
                name: `é˜Ÿä¼${newTeamNumber}`,
                tips: teamTips || 'æš‚æ— è¯´æ˜',
                creator: currentUser,
                members: {},
                createdAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            closeCreateTeamModal();
            showMessage('jjc-message', 'é˜Ÿä¼åˆ›å»ºæˆåŠŸï¼', 'success');
        }
        
        // åˆ é™¤é˜Ÿä¼
        function deleteTeam(teamId) {
            if (!currentUser) return;
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé˜Ÿä¼å—ï¼Ÿ')) {
                database.ref(`jjcTeams/${teamId}`).remove();
                showMessage('jjc-message', 'é˜Ÿä¼å·²åˆ é™¤', 'success');
            }
        }
        
        // æ›´æ–°é˜Ÿä¼åˆ—è¡¨
        function updateTeamsList() {
            const container = document.getElementById('teams-list');
            container.innerHTML = '';
            
            // æŒ‰åˆ›å»ºæ—¶é—´æ’åº
            const sortedTeams = Object.values(jjcTeams).sort((a, b) => a.createdAt - b.createdAt);
            
            sortedTeams.forEach(team => {
                const memberCount = Object.keys(team.members || {}).length;
                const isFull = memberCount >= 3;
                const isCreator = currentUser && team.creator === currentUser;
                const isMember = currentUser && team.members && team.members[currentUser];
                
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team-container';
                
                // é˜Ÿä¼åŸºæœ¬ä¿¡æ¯
                const teamInfoDiv = document.createElement('div');
                teamInfoDiv.className = 'team-item';
                teamInfoDiv.innerHTML = `
                    <div class="team-info">
                        <div class="team-name">
                            ${team.name}
                            ${isFull ? '<span style="color: #f44336; margin-left: 8px;">[æ»¡å‘˜]</span>' : ''}
                            ${isCreator ? '<span style="color: #2196f3; margin-left: 8px;">[æˆ‘åˆ›å»ºçš„]</span>' : ''}
                        </div>
                        <div class="team-tips">${team.tips || 'æš‚æ— è¯´æ˜ï¼ˆæ³¨æ„åŠ ä¸Šå¼€æ‰“æ—¶é—´å’Œæ®µä½ï¼‰'}</div>
                        <div class="team-members">
                            æˆå‘˜ï¼ˆ${memberCount}/3ï¼‰ï¼š
                            ${Object.entries(team.members || {}).map(([id, prof]) => 
                                `<span class="member-slot">${id}(${prof})</span>`
                            ).join('')}
                            ${Array(3 - memberCount).fill('<span class="member-slot empty">ç©ºä½</span>').join('')}
                        </div>
                    </div>
                `;
                teamDiv.appendChild(teamInfoDiv);
                
                // åˆ›å»ºè€…ç¼–è¾‘åŒºåŸŸ
                if (isCreator) {
                    const editSection = document.createElement('div');
                    editSection.className = 'edit-tips-section';
                    editSection.innerHTML = `
                        <textarea id="tips-${team.id}" placeholder="æ³¨æ„åŠ ä¸Šå¼€æ‰“æ—¶é—´å’Œæ®µä½">${team.tips || ''}</textarea>
                        <button class="button small" onclick="updateTeamTips('${team.id}')">æ›´æ–°è¯´æ˜</button>
                    `;
                    teamDiv.appendChild(editSection);
                }
                
                // åŠ å…¥é˜Ÿä¼åŒºåŸŸï¼ˆåªåœ¨å·²ç™»å½•ã€æœªæ»¡å‘˜ä¸”å½“å‰ç”¨æˆ·æœªåŠ å…¥æ—¶æ˜¾ç¤ºï¼‰
                if (currentUser && !isFull && !isMember) {
                    const joinSection = document.createElement('div');
                    joinSection.className = 'join-section';
                    joinSection.innerHTML = `
                        <label>é€‰æ‹©å¿ƒæ³•åŠ å…¥é˜Ÿä¼ï¼š</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                            <select id="join-${team.id}" style="width: 150px;">
                                ${[...dpsProfessions, ...healerProfessions].map(prof => 
                                    `<option value="${prof}">${prof}</option>`
                                ).join('')}
                            </select>
                            <button class="button small success" onclick="joinTeam('${team.id}')">åŠ å…¥é˜Ÿä¼</button>
                        </div>
                    `;
                    teamDiv.appendChild(joinSection);
                }
                
                // æ“ä½œæŒ‰é’®åŒºåŸŸ
                if (currentUser) {
                    const actionSection = document.createElement('div');
                    actionSection.className = 'action-section';
                    
                    // é€€å‡ºé˜Ÿä¼æŒ‰é’®ï¼ˆéåˆ›å»ºè€…çš„æˆå‘˜å¯ä»¥é€€å‡ºï¼‰
                    if (isMember && !isCreator) {
                        actionSection.innerHTML += `
                            <button class="button small danger" onclick="leaveTeam('${team.id}')">é€€å‡ºé˜Ÿä¼</button>
                        `;
                    }
                    
                    // åˆ é™¤é˜Ÿä¼æŒ‰é’®ï¼ˆåªæœ‰åˆ›å»ºè€…å¯ä»¥åˆ é™¤ï¼‰
                    if (isCreator) {
                        actionSection.innerHTML += `
                            <button class="button small danger" onclick="deleteTeam('${team.id}')">åˆ é™¤é˜Ÿä¼</button>
                        `;
                    }
                    
                    if (actionSection.innerHTML) {
                        teamDiv.appendChild(actionSection);
                    }
                }
                
                container.appendChild(teamDiv);
            });
            
            if (sortedTeams.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— é˜Ÿä¼</p>';
            }
        }
        
        // æ›´æ–°é˜Ÿä¼è¯´æ˜
        function updateTeamTips(teamId) {
            const tips = document.getElementById(`tips-${teamId}`).value.trim();
            database.ref(`jjcTeams/${teamId}/tips`).set(tips);
            showMessage('jjc-message', 'é˜Ÿä¼è¯´æ˜æ›´æ–°æˆåŠŸï¼', 'success');
        }
        
        // åŠ å…¥é˜Ÿä¼
        function joinTeam(teamId) {
            if (!currentUser) {
                showMessage('jjc-message', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            const selectElement = document.getElementById(`join-${teamId}`);
            if (!selectElement) {
                showMessage('jjc-message', 'åŠ å…¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                return;
            }
            
            const profession = selectElement.value;
            database.ref(`jjcTeams/${teamId}/members/${currentUser}`).set(profession);
            showMessage('jjc-message', 'åŠ å…¥é˜Ÿä¼æˆåŠŸï¼', 'success');
        }
        
        // é€€å‡ºé˜Ÿä¼
        function leaveTeam(teamId) {
            if (!currentUser) return;
            
            database.ref(`jjcTeams/${teamId}/members/${currentUser}`).remove();
            showMessage('jjc-message', 'å·²é€€å‡ºé˜Ÿä¼', 'success');
        }
        
        // æ´—ç‰Œç®—æ³•
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }
        
        // æ¸…é™¤æ¶ˆæ¯
        function clearMessages() {
            document.getElementById('user-message').innerHTML = '';
            document.getElementById('match-message').innerHTML = '';
            document.getElementById('jjc-message').innerHTML = '';
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            if (event.target == document.getElementById('createTeamModal')) {
                closeCreateTeamModal();
            }
        }
        
        // åˆå§‹åŒ–
        window.onload = () => {
            initFirebase();
            initPoolProfessions();
            updateJJCLoginStatus();
            updateCurrentUserDisplay();
        };
    </script>
</body>
</html>
